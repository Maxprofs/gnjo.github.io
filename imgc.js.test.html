<head></head>
<body>
<script src="//gnjo.github.io/use.js"></script>
<script src="//gnjo.github.io/filter.js"></script>
<script src="//gnjo.github.io/md5.min.js"></script>

<div id="upload" class="white-layer">
 <section id="list"></section>
</div> 

<style>
body{width:100vw;height:100vh;}
#upload{width:100%; height:100%;}
/*.thumb{height:300px;}*/
#list{display:flex;flex-direction:row;flex-wrap:wrap;}
</style>
<script>
  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();
   
   //both ondrop and input type=file
   var files = evt.target.files||evt.dataTransfer.files;

    // Loop through the FileList and render image files as thumbnails.
    ;[].slice.call(files).filter(f=>f.type.match('image.*')).map((f)=>{ 
      // Only process image files.
      let reader = new FileReader()
      ,caller = function(e) {
          imgc(e.target.result).fit({w:200,h:150,fa:2})
           .filter('grayscale')
           .filter('_median')
           //.filter('_blur')       
          /*toCanvas2(e.target.result)*/.then((d)=>{
           let name = f.name
           ,src = d
           ,el = fn.fr(`<img class="thumb cf" src="${src}" title="${name}"></img>`)
           ;
            //console.log(name, md5(src))
            fn.g('list').appendChild( el);
          })
        }
      ;
      reader.onloadend=caller;
      reader.readAsDataURL(f);
     });
     
    }   

  function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
   evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }


  var dz=fn.g('upload');
  dz.ondragover =handleDragOver;
  dz.ondrop=handleFileSelect;

</script>

</body>
